# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

## Brief
–ë–∏–∑–Ω–µ—Å-—Ü–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±—ã—Å—Ç—Ä—ã–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∏–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ —á–µ—Ä–µ–∑ Telegram. –°—Ü–µ–Ω–∞—Ä–∏–π: –±–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–º –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –≤–µ—â–∞–º–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π –æ–¥–µ–∂–¥–µ. –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è ‚Äî —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç). –§–æ–∫—É—Å MVP: –±–µ–∑–æ—à–∏–±–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–µ—â–µ–π, –±—ã—Å—Ç—Ä—ã–π ¬´–≤–∞—É¬ª-—Ä–µ–Ω–¥–µ—Ä, –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.

## User Flow
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫ –∏ –≥–æ—Ä–æ–¥ (–¥–ª—è –ø–æ–≥–æ–¥—ã).
2. –û–Ω–±–æ—Ä–¥–∏–Ω–≥: –∑–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–µ–ª—Ñ–∏ –∏ 3‚Äì8 —Ñ–æ—Ç–æ –≤–µ—â–µ–π (–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º: –≤–µ—Ä—Ö/–Ω–∏–∑/–æ–±—É–≤—å/–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã).
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∫–Ω–æ–ø–∫–∞–º–∏ –∏–ª–∏ –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ (–≥–æ–ª–æ—Å/—Ç–µ–∫—Å—Ç): —Å—Ç–∏–ª—å, —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã, –ø–∞–ª–∏—Ç—Ä–∞, —Ü–µ–ª—å –æ–±—Ä–∞–∑–∞.
4. –ë–æ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –≤–µ—â–∏, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã, –∫–æ–¥–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç ¬´–ß—Ç–æ –Ω–∞–¥–µ—Ç—å —Å–µ–≥–æ–¥–Ω—è?¬ª –∏ –∑–∞–¥–∞—ë—Ç —É—Å–ª–æ–≤–∏—è (–ø–æ–≥–æ–¥–∞, –ø–æ–≤–æ–¥, —Ü–≤–µ—Ç).
6. –†–µ–∑—É–ª—å—Ç–∞—Ç: 1‚Äì2 –∫–æ–º–ø–ª–µ–∫—Ç–∞ + –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + —Å–ø–∏—Å–æ–∫ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—â–µ–π.
7. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω—É–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ ‚Äî –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ—Ö–æ–∂–µ–µ –∫—É–ø–∏—Ç—å¬ª (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞).
8. –§–∏–¥–±–µ–∫: üëç/üëé + –∫–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
### Telegram Interface
- `bot_service/handler.py` ‚Äî –∫–æ–º–∞–Ω–¥—ã, –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã, –º–µ–¥–∏–∞.
- `bot_service/voice_processor.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ STT.

### API Gateway / Backend
- `api/main.py` (FastAPI) ‚Äî –≤–Ω–µ—à–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, webhook, health.
- `api/auth.py` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### Storage
- `storage/images/` ‚Äî –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/Wasabi).
- `db/models.py` ‚Äî PostgreSQL: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –≤–µ—â–∏, —Å–µ—Å—Å–∏–∏, —Ñ–∏–¥–±–µ–∫, —Ä–µ—Ñ–µ—Ä–∞–ª—ã.

### Image Processing
- `imgproc/segmentation.py` ‚Äî —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –º–∞—Å–∫–∏.
- `imgproc/color_extract.py` ‚Äî –ø–∞–ª–∏—Ç—Ä–∞.
- `imgproc/normalize.py` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑—ã –∏ –æ—Å–≤–µ—â–µ–Ω–∏—è.

### Face & Identity
- `face/encode.py` ‚Äî —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è.
- `face/anonymize.py` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è.

### Catalog & Attribute Extraction
- `catalog/classifier.py` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –ø—Ä–µ–¥–º–µ—Ç–∞.
- `catalog/attribute_extractor.py` ‚Äî —Ü–≤–µ—Ç, —É–∑–æ—Ä, –º–∞—Ç–µ—Ä–∏–∞–ª, –¥–ª–∏–Ω–∞, –ø–æ—Å–∞–¥–∫–∞.

### Recommender / Outfit Builder
- `recommender/rules_engine.py` ‚Äî –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (–ø–æ–≥–æ–¥–∞, –ø–æ–≤–æ–¥).
- `recommender/scorer.py` ‚Äî —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤.
- `recommender/feedback_updater.py` ‚Äî –æ–Ω–ª–∞–π–Ω-–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ñ–∏–¥–±—ç–∫–µ.

### NLP / Dialog
- `nlp/intent.py` ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ (–ø–æ–≤–æ–¥, —Å—Ç–∏–ª—å, –ø–∞–ª–∏—Ç—Ä–∞).
- `nlp/stylename_resolver.py` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤.
- `nlp/chatgpt_client.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ChatGPT (system/user prompts).

### Image Generation
- `imggen/prompt_builder.py` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON-–ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è Fal.ai/SDXL.
- `imggen/generator_client.py` ‚Äî –∑–∞–ø—Ä–æ—Å—ã –∫ Fal.ai API, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å–∫–∞–º–∏.
- `imggen/postproc.py` ‚Äî –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞.

### Workers & Queue
- `workers/generation_worker.py` ‚Äî —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Celery/RQ).
- `workers/cleanup.py` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### Analytics / Monitoring
- `monitoring/logging.py`, `metrics/prometheus_exporter.py`.

### Admin & Config
- `admin/dashboard.py` ‚Äî —Ä—É—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏.
- `config/*.yaml` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∏ –ø–æ—Ä–æ–≥–æ–≤.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- Python 3.11, FastAPI.
- PostgreSQL, Redis (–∫–µ—à + –æ—á–µ—Ä–µ–¥—å).
- Celery / RQ.
- S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- PyTorch, torchvision, OpenCV, Detectron2/SegmentAnything.
- face-recognition / insightface.
- Whisper (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ API).
- OpenAI ChatGPT API.
- Fal.ai API / Stable Diffusion XL.
- RabbitMQ/Redis.
- Sentry, Prometheus, Grafana.

## –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
### –ö–∞—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ
- –†–∏—Å–∫: –ø–ª–æ—Ö–æ–µ —Å–µ–ª—Ñ–∏/—Ñ–æ—Ç–æ ‚Üí –Ω–µ–≤–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å—ä—ë–º–∫–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ—Å—å–±–∞.

### –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ª–∏—Ü–∞
- –†–∏—Å–∫: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∏—Ü–∞, —É—Ç–µ—á–∫–∏ –±–∏–æ–º–µ—Ç—Ä–∏–∏.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: —Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤–º–µ—Å—Ç–æ —Å—ã—Ä—ã—Ö —Ñ–æ—Ç–æ, —Å–æ–≥–ª–∞—Å–∏–µ, –æ–ø—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è.

### –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –∏ —Å—Ç–∏–ª–∏ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π
- –†–∏—Å–∫: —Ç–æ—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: ¬´inspired by¬ª –±–µ–∑ –ø—Ä—è–º–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ TOS.

### –ù–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –†–∏—Å–∫: NSFW –∏–ª–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: safety classifier –¥–æ –ø–æ–∫–∞–∑–∞, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–µ–º.

### Hallucination (LLM)
- –†–∏—Å–∫: LLM –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–µ—â–∏.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã, –õ–õ–ú ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞.

### –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –∏ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ
- –†–∏—Å–∫: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç–∞ –∫ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º.
- –ú–∏—Ç–∏–≥a—Ü–∏—è: —Ä–∞–Ω–Ω–µ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–π, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–π—Å–∏–Ω–≥–∞.

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–º–ø—Ç–æ–≤
### –ê—Ç—Ä–∏–±—É—Ç—ã –≤–µ—â–∏
- CV-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç class, subclass, color (hex), pattern, material, fit, length, dominant_texture.
- –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–∞—Å–∫—É, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∏–ª—É—ç—Ç.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî `unknown`.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è confidence, –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ ‚Äî —Ñ–ª–∞–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏.

### –ü—Ä–æ–º–ø—Ç –¥–ª—è ChatGPT
- **System prompt** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å —Å—Ç–∏–ª–∏—Å—Ç–∞, —Ñ–æ—Ä–º–∞—Ç (JSON + —Ç–µ–∫—Å—Ç), –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –≤–µ—â–∏), –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–ø–æ–≥–æ–¥–∞ ‚Üí –ø–æ–≤–æ–¥ ‚Üí –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è).
- **User prompt** –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, wardrobe items (JSON —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏, mask refs), intent, weather, inspiration, –∏—Å—Ç–æ—Ä–∏—é —Ñ–∏–¥–±—ç–∫–∞.
- **Output**: JSON —Å `suggested_outfit`, `natural_text`, `reasons`, `missing_items`.
- –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å 2‚Äì3 few-shot –ø—Ä–∏–º–µ—Ä–∞.

### –ü—Ä–æ–º–ø—Ç –¥–ª—è Image Generation
- `prompt_builder` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –ª–∏—Ü–æ, –º–∞—Å–∫–∏ –æ–¥–µ–∂–¥—ã, –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–∑–µ, —Ñ–æ–Ω, –æ—Å–≤–µ—â–µ–Ω–∏–µ, —É—Ä–æ–≤–µ–Ω—å —Ä–µ–∞–ª–∏–∑–º–∞.
- Negative prompt ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (nudity, logos, weapon).
- –ü–æ—Å—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∞: safety-detector –∏ –ø–æ—Ä–æ–≥ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏ –ª–∏—Ü–∞.

## –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–°–≤–∏–¥–∞–Ω–∏–µ**: —Ç—ë–ø–ª–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ, –º—è–≥–∫–∏–π –±–æ–∫–µ, –ª—ë–≥–∫–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å 0.2).
- **–û—Ñ–∏—Å**: —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–æ–Ω, –º–∏–Ω–∏–º—É–º —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å 0.0).
- **Street/trend**: –¥–∏–Ω–∞–º–∏—á–Ω–∞—è –ø–æ–∑–∞, –≥–æ—Ä–æ–¥—Å–∫–æ–π —Ñ–æ–Ω, –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å 0.4).

## Clarifying Questions (—Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏)
1. –°—Ç–µ–ø–µ–Ω—å —Ä–µ–∞–ª–∏–∑–º–∞? ‚Üí ¬´—É–º–µ—Ä–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π¬ª.
2. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–ª—Ñ–∏? ‚Üí 30 –¥–Ω–µ–π, –∑–∞—Ç–µ–º –∞–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ.
3. –û–±—Ä–∞–∑—ã —Å celeb? ‚Üí —Ç–æ–ª—å–∫–æ ¬´inspired by¬ª.
4. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (0‚Äì1)? ‚Üí 0.2.
5. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–µ—â–∏? ‚Üí –∫–ª–∞—Å—Å + —Ñ–æ—Ç–æ.
6. –ü–æ—Ä–æ–≥ confidence –¥–ª—è –∞–≤—Ç–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è? ‚Üí 0.7.
7. –î–æ–ø—É—Å—Ç–∏–º—ã –ª–∏ –ª–æ–≥–æ—Ç–∏–ø—ã? ‚Üí –Ω–µ—Ç, –∑–∞—Ç–∏—Ä–∞–µ–º.
8. –ú–∞–∫—Å–∏–º—É–º –≤–µ—â–µ–π –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ? ‚Üí 5.
9. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–ø–æ–∑/–∞–Ω–∏–º–∞—Ü–∏–∏? ‚Üí –Ω–µ—Ç.
10. SLA –æ—Ç–≤–µ—Ç–∞? ‚Üí —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚â§ 30‚Äì60 —Å–µ–∫ (MVP –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ).
11. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è? ‚Üí 18‚Äì45, –ª—é–±–æ–π –ø–æ–ª.
12. –•—Ä–∞–Ω–∏—Ç—å embeddings –≥–∞—Ä–¥–µ—Ä–æ–±–∞? ‚Üí –¥–∞, –∞–Ω–æ–Ω–∏–º–Ω–æ –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ.
13. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–æ—Ö–∏—Ö —Ñ–æ—Ç–æ? ‚Üí –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ—Å–Ω—è—Ç—å (confidence < 0.5).
14. –§–æ—Ä–º–∞—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫? ‚Üí –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç (–æ—Å–Ω–æ–≤–Ω–æ–π).
15. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è? ‚Üí –¥–∞, —Å –ø–æ–º–µ—Ç–∫–æ–π ¬´–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞¬ª.

## Scene JSON (–ø—Ä–∏–º–µ—Ä)
```json
{
  "scene_id": "uuid-1234",
  "user_id": "user-5678",
  "face_reference": {
    "image_id": "img_face_001",
    "embedding_id": "emb_face_001",
    "preserve_identity": true,
    "face_confidence_threshold": 0.85
  },
  "garments": [
    {
      "garment_id": "g_001",
      "class": "jacket",
      "subclass": "bomber",
      "color": "#2b2f3a",
      "pattern": "solid",
      "material": "nylon",
      "fit": "regular",
      "mask_id": "mask_g_001",
      "layer": "outer"
    },
    {
      "garment_id": "g_002",
      "class": "shirt",
      "subclass": "tshirt",
      "color": "#ffffff",
      "pattern": "logo_free",
      "material": "cotton",
      "fit": "slim",
      "mask_id": "mask_g_002",
      "layer": "base"
    },
    {
      "garment_id": "g_003",
      "class": "jeans",
      "subclass": "straight",
      "color": "#2a3b6f",
      "pattern": "solid",
      "material": "denim",
      "fit": "regular",
      "mask_id": "mask_g_003",
      "layer": "bottom"
    }
  ],
  "composition": {
    "pose": "natural_standing_slight_turn",
    "hands": "in_pockets_optional",
    "framing": "waist_up_or_full_body_auto",
    "background": {
      "type": "neutral_blurred_interior",
      "color_tone": "warm",
      "depth_of_field": "medium"
    },
    "lighting": {
      "key": "soft_key_from_left",
      "fill": "ambient",
      "shadow_strength": 0.3
    },
    "camera": {
      "focal_length_mm": 50,
      "angle": "eye_level",
      "distance": "1.5m"
    }
  },
  "style_settings": {
    "realism": "photo_realistic",
    "color_grade": "natural_plus_contrast",
    "effects_aggressiveness": 0.2,
    "grain": 0.05,
    "sharpen": 0.1
  },
  "safety": {
    "ban_logos": true,
    "ban_brand_replicas": true,
    "disallow_face_swap_public_figures": true,
    "nsfw_filter_level": "strict"
  },
  "outputs": {
    "primary": {
      "width": 1024,
      "height": 1536,
      "format": "jpeg",
      "quality": 90
    },
    "preview": {
      "width": 512,
      "height": 768,
      "format": "jpeg"
    }
  },
  "meta": {
    "created_at": "2025-10-23T12:00:00Z",
    "intent": "daily_outfit",
    "occasion": "casual_coffee",
    "weather_context": {
      "temp_c": 12,
      "condition": "light_rain"
    },
    "inspiration": [
      "timoth\u00e9e chalamet - casual",
      "scandi_minimal"
    ],
    "referrals_needed": true
  }
}
```

## –ü–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ –ø–æ–ª—è–º
- `mask_id` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Å–∫—É –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è inpainting/overlay.
- `preserve_identity` –∏ `face_confidence_threshold` ‚Äî –µ—Å–ª–∏ –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç—Å—è.
- `safety` ‚Äî –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã—Ö –¥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É.
- `effects_aggressiveness` ‚Äî –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (0 ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ, 1 ‚Äî —Å–∏–ª—å–Ω–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è).
